<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to add a new camera tracker algorithm &mdash; Apollo Auto alpha documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/cyber/doxy-docs/source/main_stylesheet.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/tabs.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="如何添加新的camera匹配算法" href="how_to_add_a_new_camera_tracker_algorithm_cn.html" />
    <link rel="prev" title="如何添加新的camera检测算法" href="how_to_add_a_new_camera_detector_algorithm_cn.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: skyblue" >
            <a href="../../index.html" class="icon icon-home"> Apollo Auto
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Apollo Auto 自述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Apollo Auto 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cyber/doxy-docs/source/index.html">cyber 文档</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: skyblue" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apollo Auto</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>How to add a new camera tracker algorithm</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/howto/how_to_add_a_new_camera_tracker_algorithm.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="how-to-add-a-new-camera-tracker-algorithm">
<h1>How to add a new camera tracker algorithm<a class="headerlink" href="#how-to-add-a-new-camera-tracker-algorithm" title="Permalink to this headline"></a></h1>
<p>The processing flow of camera perception module is shown below:
<img alt="camera overview" src="../../_images/Camera_overview.png" /></p>
<p>The 2 tracker algorithms introduced by this document were traffic_light_tracker and obstacle_tracker (lane_tracker is reserved but not used so far). These 2 trackers are located in their own component. The architecture of each component is showed below:</p>
<p>Traffic Light:
<img alt="traffic light component" src="../../_images/camera_traffic_light_detection.png" /></p>
<p>Obstacle:
<img alt="obstacle component" src="../../_images/camera_obstacle_detection.png" /></p>
<p>As we can see clearly from above structure, each component has its own abstract class member <code class="docutils literal notranslate"><span class="pre">base_XXX_tracker</span></code>. Different derived tracker algorithms inherit <code class="docutils literal notranslate"><span class="pre">base_XXX_tracker</span></code> and implement their main flows to complete the deployment. Next, we will take <code class="docutils literal notranslate"><span class="pre">base_obstacle_tracker</span></code> as an example to introduce how to add a new camera tracker algorithm. You could also refer to this document if you want to add traffic light tracker.</p>
<p>Apollo has provided one camera tracker algorithm in Obstacle Detection – OMTObstacleTracker. It could be easily changed or replaced by other algorithms. The input of algorithm should be objective obstacle data processed by previous detector, while the output should be matched and tracked objective obstacle data. This document will introduce how to add a new camera tracker algorithm, the basic task sequence is listed below：</p>
<ol class="simple">
<li><p>Define a class that inherits <code class="docutils literal notranslate"><span class="pre">base_obstacle_tracker</span></code></p></li>
<li><p>Implement the class <code class="docutils literal notranslate"><span class="pre">NewObstacleTracker</span></code></p></li>
<li><p>Add param proto file for <code class="docutils literal notranslate"><span class="pre">NewObstacleTracker</span></code></p></li>
<li><p>Update config file to put your tracker into effect</p></li>
</ol>
<p>The steps are elaborated below for better understanding:</p>
<section id="define-a-class-that-inherits-base-obstacle-tracker">
<h2>Define a class that inherits <code class="docutils literal notranslate"><span class="pre">base_obstacle_tracker</span></code><a class="headerlink" href="#define-a-class-that-inherits-base-obstacle-tracker" title="Permalink to this headline"></a></h2>
<p>All the camera tracker algorithms shall inherit <code class="docutils literal notranslate"><span class="pre">base_obstacle_tracker</span></code>，which defines a set of interfaces. Here is an example of the tracker implementation:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span><span class="w"> </span><span class="nn">apollo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">perception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">camera</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="k">class</span> <span class="nc">NewObstacleTracker</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BaseObstacleTracker</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="n">NewObstacleTracker</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">NewObstacleTracker</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Init</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerInitOptions</span><span class="o">&amp;</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Predict</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerOptions</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="n">CameraFrame</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Associate2D</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerOptions</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="n">CameraFrame</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Associate3D</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerOptions</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="n">CameraFrame</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Track</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerOptions</span><span class="o">&amp;</span><span class="w"> </span><span class="n">options</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="n">CameraFrame</span><span class="o">*</span><span class="w"> </span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="p">};</span><span class="w">  </span><span class="c1">// class NewObstacleTracker</span>

<span class="p">}</span><span class="w">  </span><span class="c1">// namespace camera</span>
<span class="p">}</span><span class="w">  </span><span class="c1">// namespace perception</span>
<span class="p">}</span><span class="w">  </span><span class="c1">// namespace apollo</span>
</pre></div>
</div>
<p>The function signature of <code class="docutils literal notranslate"><span class="pre">base_obstacle_tracker</span></code> is pre-defined：</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">ObstacleTrackerInitOptions</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BaseInitOptions</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">image_width</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">image_height</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">ObstacleTrackerOptions</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">CameraFrame</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// timestamp</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// frame sequence id</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">frame_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// data provider</span>
<span class="w">  </span><span class="n">DataProvider</span><span class="w"> </span><span class="o">*</span><span class="n">data_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// calibration service</span>
<span class="w">  </span><span class="n">BaseCalibrationService</span><span class="w"> </span><span class="o">*</span><span class="n">calibration_service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// hdmap struct</span>
<span class="w">  </span><span class="n">base</span><span class="o">::</span><span class="n">HdmapStructPtr</span><span class="w"> </span><span class="n">hdmap_struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// tracker proposed objects</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">base</span><span class="o">::</span><span class="n">ObjectPtr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">proposed_objects</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// segmented objects</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">base</span><span class="o">::</span><span class="n">ObjectPtr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">detected_objects</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// tracked objects</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">base</span><span class="o">::</span><span class="n">ObjectPtr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tracked_objects</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// feature of all detected object ( num x dim)</span>
<span class="w">  </span><span class="c1">// detect lane mark info</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">base</span><span class="o">::</span><span class="n">LaneLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lane_objects</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pred_vpt</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">base</span><span class="o">::</span><span class="n">Blob</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">track_feature_blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">base</span><span class="o">::</span><span class="n">Blob</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">lane_detected_blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// detected traffic lights</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">base</span><span class="o">::</span><span class="n">TrafficLightPtr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">traffic_lights</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// camera intrinsics</span>
<span class="w">  </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3f</span><span class="w"> </span><span class="n">camera_k_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3f</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="c1">// narrow to obstacle projected_matrix</span>
<span class="w">  </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="w"> </span><span class="n">project_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="c1">// camera to world pose</span>
<span class="w">  </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Affine3d</span><span class="w"> </span><span class="n">camera2world_pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Affine3d</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="n">EIGEN_MAKE_ALIGNED_OPERATOR_NEW</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">EIGEN_ALIGN16</span><span class="p">;</span><span class="w">  </span><span class="c1">// struct CameraFrame</span>
</pre></div>
</div>
</section>
<section id="implement-the-class-newobstacletracker">
<h2>Implement the class <code class="docutils literal notranslate"><span class="pre">NewObstacleTracker</span></code><a class="headerlink" href="#implement-the-class-newobstacletracker" title="Permalink to this headline"></a></h2>
<p>To ensure the new tracker could function properly, <code class="docutils literal notranslate"><span class="pre">NewObstacleTracker</span></code> should at least override the interface Init(), Track(), Name() defined in <code class="docutils literal notranslate"><span class="pre">base_obstacle_tracker</span></code> Init() is resposible for config loading, class member initialization, etc. And Track() will implement the basic logic of algorithm. A concrete <code class="docutils literal notranslate"><span class="pre">NewObstacleTracker.cc</span></code> example is shown：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Note：Currently, the algorithm pipeline has not been encapsulated into the Track() function of base_obstacle_tracker.h. 
Therefore, all the virtual interface should be re-writen.
</pre></div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span><span class="w"> </span><span class="nn">apollo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">perception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">camera</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">NewObstacleTracker::Init</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerInitOptions</span><span class="o">&amp;</span><span class="w"> </span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    Initialization of your tracker</span>
<span class="cm">    */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">NewObstacleTracker::Track</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerInitOptions</span><span class="o">&amp;</span><span class="w"> </span><span class="n">options</span><span class="p">,</span><span class="w"></span>
<span class="w">                               </span><span class="n">CameraFrame</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    Implementation of your tracker</span>
<span class="cm">    */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">NewObstacleTracker::Predict</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerOptions</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">,</span><span class="w"></span>
<span class="w">                                 </span><span class="n">CameraFrame</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    Implementation of your tracker -- Predict</span>
<span class="cm">    */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Associate2D</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerOptions</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="n">CameraFrame</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    Implementation of your tracker -- Associate2D</span>
<span class="cm">    */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Associate3D</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ObstacleTrackerOptions</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="n">CameraFrame</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    Implementation of your tracker -- Associate3D</span>
<span class="cm">    */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">NewObstacleTracker::Name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    Return your tracker&#39;s name</span>
<span class="cm">    */</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">REGISTER_OBSTACLE_TRACKER</span><span class="p">(</span><span class="n">NewObstacleTracker</span><span class="p">);</span><span class="w"> </span><span class="c1">//register the new tracker</span>

<span class="p">}</span><span class="w">  </span><span class="c1">// namespace camera</span>
<span class="p">}</span><span class="w">  </span><span class="c1">// namespace perception</span>
<span class="p">}</span><span class="w">  </span><span class="c1">// namespace apollo</span>
</pre></div>
</div>
</section>
<section id="add-param-proto-file-for-newobstacletracker">
<h2>Add param proto file for <code class="docutils literal notranslate"><span class="pre">NewObstacleTracker</span></code><a class="headerlink" href="#add-param-proto-file-for-newobstacletracker" title="Permalink to this headline"></a></h2>
<p>Follow the steps below to add parameters for your new camera tracker:</p>
<ol>
<li><p>Create the <code class="docutils literal notranslate"><span class="pre">proto</span></code> file for parameters according to the requirement of your tracker. If the parameters are compatible, you can use or just modify current <code class="docutils literal notranslate"><span class="pre">proto</span></code> directly. As an example, you can refer to the <code class="docutils literal notranslate"><span class="pre">proto</span></code> file from <code class="docutils literal notranslate"><span class="pre">omt</span> <span class="pre">Tracker</span></code> at <code class="docutils literal notranslate"><span class="pre">modules/perception/camera/lib/obstacle/tracker/omt/proto/omt.proto</span></code>. Remember to include the following content once you finished your definition:</p>
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="k">syntax</span> <span class="o">=</span> <span class="s">&quot;proto2&quot;</span><span class="p">;</span>
<span class="kn">package</span> <span class="nn">apollo</span><span class="o">.</span><span class="n">perception.camera.NewObstacleTracker</span><span class="p">;</span>

<span class="c1">//Your parameters</span>
</pre></div>
</div>
</li>
<li><p>Refer to <code class="docutils literal notranslate"><span class="pre">omt_obstacle_tracker</span></code> at <code class="docutils literal notranslate"><span class="pre">modules/perception/production/data/perception/camera/models/</span></code> and create your <code class="docutils literal notranslate"><span class="pre">new_obstacle_tracker</span></code> folder and <code class="docutils literal notranslate"><span class="pre">*.pt</span></code> file：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Note：The &quot;*.pt&quot; file should have the format defined in step one
</pre></div>
</div>
</li>
</ol>
</section>
<section id="update-config-file-to-put-your-tracker-into-effect">
<h2>Update config file to put your tracker into effect<a class="headerlink" href="#update-config-file-to-put-your-tracker-into-effect" title="Permalink to this headline"></a></h2>
<p>To use your new camera tracker algorithm in Apollo， you have to config the following files according to your demand:</p>
<ol>
<li><p>Refer to the following content to update <code class="docutils literal notranslate"><span class="pre">modules/perception/production/conf/perception/camera/obstacle.pt</span></code>,put your <code class="docutils literal notranslate"><span class="pre">*.pt</span></code> file created in previous step to the load path:</p>
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="n">tracker_param</span> <span class="p">{</span>
<span class="n">plugin_param</span><span class="p">{</span>
    <span class="n">name</span> <span class="o">:</span> <span class="s">&quot;NewObstacleTracker&quot;</span>
    <span class="n">root_dir</span> <span class="o">:</span> <span class="s">&quot;/apollo/modules/perception/production/data/perception/camera/models/new_obstacle_tracker&quot;</span>
    <span class="n">config_file</span> <span class="o">:</span> <span class="s">&quot;*.pt&quot;</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>If you want to modify the structure of <code class="docutils literal notranslate"><span class="pre">tracker_param</span></code> shown in step one or just add a new <code class="docutils literal notranslate"><span class="pre">_param</span></code>, your can do that at <code class="docutils literal notranslate"><span class="pre">modules/perception/camera/app/proto/perception.proto</span></code>:</p>
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">PluginParam</span> <span class="p">{</span>
<span class="k">optional</span> <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">optional</span> <span class="kt">string</span> <span class="na">root_dir</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">optional</span> <span class="kt">string</span> <span class="na">config_file</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">message</span> <span class="nc">TrackerParam</span> <span class="p">{</span>
<span class="k">optional</span> <span class="n">PluginParam</span> <span class="na">plugin_param</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>If you create a new <code class="docutils literal notranslate"><span class="pre">*.pt</span></code> instead of using <code class="docutils literal notranslate"><span class="pre">obstacle.pt</span></code> given in step one， you also have to modify <code class="docutils literal notranslate"><span class="pre">modules/perception/production/conf/perception/camera/fusion_camera_detection_component.pb.txt</span></code>. The corresponding <code class="docutils literal notranslate"><span class="pre">proto</span></code> file is <code class="docutils literal notranslate"><span class="pre">modules/perception/onboard/proto/fusion_camera_detection_component.proto</span></code>：</p>
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="n">camera_obstacle_perception_conf_dir</span> <span class="o">:</span> <span class="s">&quot;/apollo/modules/perception/production/conf/perception/camera&quot;</span>
<span class="n">camera_obstacle_perception_conf_file</span> <span class="o">:</span> <span class="s">&quot;NewObstacleTracker.pt&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>Once you finished the above modifications, you new camera tracker should take effect in Apollo.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="how_to_add_a_new_camera_detector_algorithm_cn.html" class="btn btn-neutral float-left" title="如何添加新的camera检测算法" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="how_to_add_a_new_camera_tracker_algorithm_cn.html" class="btn btn-neutral float-right" title="如何添加新的camera匹配算法" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, xinetzone.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>