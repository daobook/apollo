<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rf &mdash; Apollo Auto alpha 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/cyber/doxy-docs/source/main_stylesheet.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/tabs.js"></script>
        <script src="../../_static/translations.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="ff" href="how_to_monitor_perf_with_oprofile_on_tx2_cn.html" />
    <link rel="prev" title="How to Leverage Scenario Editor" href="how_to_leverage_scenario_editor.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: skyblue" >
            <a href="../../index.html" class="icon icon-home"> Apollo Auto
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Apollo Auto 自述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Apollo Auto 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cyber/doxy-docs/source/index.html">cyber 文档</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: skyblue" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apollo Auto</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>rf</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/howto/how_to_monitor_perf_with_oprofile_on_tx2.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="rf">
<h1>rf<a class="headerlink" href="#rf" title="永久链接至标题"></a></h1>
<p>oprofile is a performance monitoring tool that runs on linux system. Generally, oprofile has been included in linux system modules, but oprofile module is not supported on ARM, so we have to install it manually.</p>
<p>oprofile supports multi-thread program. It records the number of function calls, and can also output the source code to show results user-friendly. So it fits well to performance monitoring on TX2.</p>
<section id="download">
<h2>Download<a class="headerlink" href="#download" title="永久链接至标题"></a></h2>
<p>Download the newest version of oprofile</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wget http://prdownloads.sourceforge.net/oprofile/oprofile-1.4.0.tar.gz
$ tar zxvf oprofile-1.4.0.tar.gz
$ <span class="nb">cd</span> oprofile-1.4.0
</pre></div>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="永久链接至标题"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install libpopt-dev libiberty-dev binutils-dev
$ ./configure
$ make -j4
$ sudo make install
</pre></div>
</div>
</section>
<section id="test">
<h2>Test<a class="headerlink" href="#test" title="永久链接至标题"></a></h2>
<p>After installation，perform command <code class="docutils literal notranslate"><span class="pre">operf</span></code> to see if it could get CPU information normally. If it fails and the output is like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">unable</span> <span class="pre">to</span> <span class="pre">open</span> <span class="pre">/sys/devices/system/cpu/cpu0/online</span></code></p>
<p>This is because TX2 only launches 4 CPU cores by default. The other two CPU cores are closed.
Use below command to open the other two CPU cores:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo nvpmodel -m <span class="m">0</span>
</pre></div>
</div>
</section>
<section id="how-to-use">
<h2>How to use<a class="headerlink" href="#how-to-use" title="永久链接至标题"></a></h2>
<p>oprofile provides variety of commands, the commands <code class="docutils literal notranslate"><span class="pre">operf</span></code>, <code class="docutils literal notranslate"><span class="pre">opreport</span></code> and <code class="docutils literal notranslate"><span class="pre">opannotate</span></code> are used more often.
Take testing perception as an example.</p>
<ul class="simple">
<li><p>1.modify <code class="docutils literal notranslate"><span class="pre">script/apollo_bash.sh</span></code>, add command <code class="docutils literal notranslate"><span class="pre">operf</span></code> behind keyword <code class="docutils literal notranslate"><span class="pre">nuhup</span></code> in line 239. As shown below：</p></li>
</ul>
<p><img alt="operf_command" src="../../_images/operf_command.png" /></p>
<ul class="simple">
<li><p>2.use script like <code class="docutils literal notranslate"><span class="pre">./script/perception.sh</span></code> to launch perception program</p></li>
</ul>
<p>And now, operf is collecting data of perception program. Stopping perception program in any approach can stop the collecting process.</p>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="永久链接至标题"></a></h2>
<p>After stopping perception program, a directory named oprofile_data is generated in current directory.
Use command <code class="docutils literal notranslate"><span class="pre">opreport</span></code> to show the total statistics:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ opreport
</pre></div>
</div>
<p>As shown below:</p>
<p><img alt="opreport_" src="../../_images/opreport_.png" /></p>
<p>Use command <code class="docutils literal notranslate"><span class="pre">opreport</span></code> to show the statistics of each function:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ opreport -l bazel-bin/modules/perception/perception 
</pre></div>
</div>
<p>Because there is too much information to show, so it’s better to save the output into a file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ opreport -l bazel-bin/modules/perception/perception &gt; perception_op_funcs.md
</pre></div>
</div>
<p>As shown below:</p>
<p><img alt="opreport_file" src="../../_images/opreport_file.png" /></p>
<p>Use command <code class="docutils literal notranslate"><span class="pre">opannotate</span></code> to show the statistics with source code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ opannotate -s bazel-bin/modules/perception/perception &gt; perception_op_details.md
</pre></div>
</div>
<p>Notice:
It only supports one operf program to be running at any time, so when operf program is running, we could launch another program with <code class="docutils literal notranslate"><span class="pre">operf</span></code>.</p>
<p>oprofile official website:
<a class="reference external" href="http://oprofile.sourceforge.net/news/">http://oprofile.sourceforge.net/news/</a></p>
<p>oprofile user manual:
<a class="reference external" href="http://oprofile.sourceforge.net/doc/index.html">http://oprofile.sourceforge.net/doc/index.html</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="how_to_leverage_scenario_editor.html" class="btn btn-neutral float-left" title="How to Leverage Scenario Editor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="how_to_monitor_perf_with_oprofile_on_tx2_cn.html" class="btn btn-neutral float-right" title="ff" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2021, xinetzone.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>